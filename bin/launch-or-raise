#!/bin/bash

# Usage function
usage() {
    echo "Usage: $0 --binary <binary_name> --selector <selector> [--process <process_name>] [--use-instance]"
    echo "  --binary: Command to launch the application"
    echo "  --selector: WM_CLASS class or instance to focus"
    echo "  --process: Process name for pgrep (defaults to binary name)"
    echo "  --use-instance: Use instance instead of class for i3-msg"
    exit 1
}

# Parse arguments
while [[ $# -gt 0 ]]; do
    case $1 in
        --binary) BINARY_NAME="$2"; shift 2 ;;
        --selector) SELECTOR="$2"; shift 2 ;;
        --process) PROCESS_NAME="$2"; shift 2 ;;
        --use-instance) USE_INSTANCE=true; shift ;;
        *) usage ;;
    esac
done

# Validate required arguments
if [ -z "$BINARY_NAME" ] || [ -z "$SELECTOR" ]; then
    usage
fi

# Set defaults
PROCESS_NAME=${PROCESS_NAME:-$BINARY_NAME}
USE_INSTANCE=${USE_INSTANCE:-false}

# Check if the application is running
if pgrep -x "$PROCESS_NAME" > /dev/null
then
    # If running, focus on it
    if [ "$USE_INSTANCE" = true ]; then
        i3-msg "[instance=\"$SELECTOR\"] focus"
    else
        i3-msg "[class=\"$SELECTOR\"] focus"
    fi
else
    # If not running, start the application
    $BINARY_NAME &
fi
