#!/bin/bash

### notify-current-media ##########################################################################
# Display the current media data.
# Dependencies: playerctl, read, notify-send
###################################################################################################

source $(dirname $(readlink -e $0))/tool/helpers

MEDIA_QUERY="{{title}}|{{mpris:artUrl}}|{{artist}}|{{album}}"

function publish() {
    IFS='|' read -r title art artist album < <(playerctl metadata --format $MEDIA_QUERY)
    notify-send -r $N_CURRENT_MEDIA -i "$art" "$title" "$album\n$artist"
}

function monitor() {
    # Monitor for media title change.
    playerctl -F metadata --format "'{{title}}'" > >( xargs -n1 $0 )
}

case "$1" in
monitor)
    monitor ;;
*)
    publish ;;
esac
